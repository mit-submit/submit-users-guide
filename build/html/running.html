<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>mit-submit - Running and Batch jobs:</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css" integrity="sha256-xOpS+e/dER8z72w+qryCieOGysQI8cELAVt3MHG0phY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/js/tooltipster.bundle.min.js" integrity="sha256-NOU7KrY2aTI4PxDegqYUIknk9qfxVCS0E4JfE9aMwaA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'mit-submitv1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
      <script src="app-data.js"></script>
<link rel="index" title="Index" href="genindex.html" />
<link rel="search" title="Search" href="search.html" />
<link rel="prev" title="Available Software:" href="program.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<a href="index.html" class="text-logo">mit-submit mit-submitv1 documentation</a>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Running and Batch jobs:">Running and Batch jobs:</h3>
        <h6>Running and Batch jobs:</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-index">
        <a href="genindex.html" class="btn btn-default" title="Go to the index"><i class="fa fa-list"></i></a>
      </div>

      <div id="hdr-source">
        <a href="_sources/running.rst.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
  <div class="prev-next">
    
      <div class="pull-left">
        <a class="btn btn-default prev" href="program.html" title="Previous chapter (Available Software:)"><i class="fa fa-chevron-left mr-1em" aria-hidden="true"></i><span class="btn-text">Available Software:</span></a>
      </div>
    
    </div>
  
      </div>
      <div id="alt-hdr-right">

        <a href="program.html"><i class="fa fa-chevron-left mr-8"></i></a>


        <a href="index.html"><i class="fa fa-home mr-8"></i></a>


        <a href="search.html"><i class="fa fa-search mr-8"></i></a>


        <a href="genindex.html"><i class="fa fa-list mr-8"></i></a>


      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
          <div id="toc-filter" title="Type in here to show only matching topics">
            <input class="form-control" id="toc-filter-query" placeholder="Filter by title ...">
          </div>
      
        
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Users guide to the <em>subMIT</em> login pool:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#introduction">Introduction:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-do-i-need-for-an-account">What do I need for an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#how-to-get-help">How to get help:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#heavy-duty-calculations">Heavy duty calculations:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="starting.html">Getting started:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="starting.html#how-to-get-an-account">How to get an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#login-and-basic-areas">Login and basic areas:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#the-rules-for-an-account">The rules for an account:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working.html">Things that work and things that don’t:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="working.html#do-this">Do this:</a></li>
<li class="toctree-l2"><a class="reference internal" href="working.html#avoid-doing-this">Avoid doing this:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="program.html#available-software">Available Software:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="program.html#native-system">Native system:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#cvmfs">CVMFS:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#conda">Conda:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#containers">Containers:</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#running-and-batch-jobs">Running and Batch jobs:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-locally">Running locally:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#htcondor-examples">HTCondor examples:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-batch-systems-to-run-at-a-given-resource">Using batch systems to run at a given resource:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#condor-example-1">Condor example 1:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#condor-example-2">Condor example 2:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slurm-examples">Slurm examples:</a></li>
</ul>
</li>
</ul>

  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Users guide to the <em>subMIT</em> login pool:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#introduction">Introduction:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-do-i-need-for-an-account">What do I need for an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#how-to-get-help">How to get help:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#heavy-duty-calculations">Heavy duty calculations:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="starting.html">Getting started:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="starting.html#how-to-get-an-account">How to get an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#login-and-basic-areas">Login and basic areas:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#the-rules-for-an-account">The rules for an account:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working.html">Things that work and things that don’t:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="working.html#do-this">Do this:</a></li>
<li class="toctree-l2"><a class="reference internal" href="working.html#avoid-doing-this">Avoid doing this:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="program.html#available-software">Available Software:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="program.html#native-system">Native system:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#cvmfs">CVMFS:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#conda">Conda:</a></li>
<li class="toctree-l2"><a class="reference internal" href="program.html#containers">Containers:</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#running-and-batch-jobs">Running and Batch jobs:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-locally">Running locally:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#htcondor-examples">HTCondor examples:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-batch-systems-to-run-at-a-given-resource">Using batch systems to run at a given resource:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#condor-example-1">Condor example 1:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#condor-example-2">Condor example 2:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slurm-examples">Slurm examples:</a></li>
</ul>
</li>
</ul>

  
          </div>
          <div class="body">
            
  <div class="section" id="running-and-batch-jobs">
<h1>Running and Batch jobs:<a class="headerlink" href="#running-and-batch-jobs" title="Permalink to this headline">¶</a></h1>
<p>This section will give you a quick guide on how to submit batch jobs at submit. There will be a couple of simple examples to help get you started.</p>
<div class="section" id="running-locally">
<h2>Running locally:<a class="headerlink" href="#running-locally" title="Permalink to this headline">¶</a></h2>
<p>The submit machines are powerful servers which can be used for local testing. This allows users to thoroughly test their code before expanding to batch submission. When you are ready to scale up your framework you can start with the examples below to start submitting to HTCondor or Slurm.</p>
</div>
<div class="section" id="htcondor-examples">
<h2>HTCondor examples:<a class="headerlink" href="#htcondor-examples" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/blob/main/test-all/base_sub">An example condor script</a></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Submit description file for test_all program</span>
<span class="c1">#----------------------------------------------</span>
<span class="nv">Executable</span>            <span class="o">=</span> run
<span class="nv">Requirements</span>          <span class="o">=</span> regexp<span class="o">(</span><span class="s2">&quot;T2.*&quot;</span>, MACHINE<span class="o">)</span>
<span class="nv">Universe</span>              <span class="o">=</span> vanilla
<span class="nv">initialdir</span>            <span class="o">=</span> /tmp
<span class="nv">transfer_input_files</span>  <span class="o">=</span> input
<span class="nv">should_transfer_files</span> <span class="o">=</span> YES
<span class="nv">WhenToTransferOutput</span>  <span class="o">=</span> ON_EXIT_OR_EVICT
<span class="nv">Log</span>                   <span class="o">=</span> test-all.log
</pre></div>
</div>
<p>There are several more examples for different application types at</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples">submit-examples</a></li>
</ol>
<p>The different examples are below:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/DAGMan">DAGMan</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/DAGMan2">DAGMan2</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/condor_gpu">condor_gpu</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/julia">julia</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/matlab">matlab</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/pythia">pythia</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/rat">rat</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/rat_python">rat_python</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/test-all">test-all</a></li>
<li><a class="reference external" href="https://github.com/mit-submit/submit-examples/tree/main/trajector">trajector</a></li>
</ol>
</div>
<div class="section" id="using-batch-systems-to-run-at-a-given-resource">
<h2>Using batch systems to run at a given resource:<a class="headerlink" href="#using-batch-systems-to-run-at-a-given-resource" title="Permalink to this headline">¶</a></h2>
<p>While using Condor you should be able to specify where you want your hobs to run at. Here we provide a couple of examples on modifying your requirements in order to run at different clusters. For more info see here:</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://submit04.mit.edu/tips.html">Tips</a></li>
</ol>
<p>The condor examople above ran on T2 machines using a regular expression but lets run on the different clusters by modifying the requirements in different ways. Lets start with requirements to run on the T2 machines:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">Requirements</span> <span class="o">=</span> <span class="o">(</span><span class="nv">BOSCOGroup</span> <span class="o">==</span> <span class="s2">&quot;bosco_cms&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">BOSCOCluster</span> <span class="o">==</span> <span class="s2">&quot;ce03.cmsaf.mit.edu&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>If instead you want to run on the T3 machines you can change the requirements to the T3 BoscoCluster:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">Requirements</span> <span class="o">=</span> <span class="o">(</span><span class="nv">BOSCOCluster</span> <span class="o">==</span> <span class="s2">&quot;t3serv008.mit.edu&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>If you are a CMS member you can also go through the US CMS global pool:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">Requirements</span> <span class="o">=</span> <span class="o">(</span> <span class="nv">BOSCOCluster</span> <span class="o">=</span>!<span class="o">=</span> <span class="s2">&quot;t3serv008.mit.edu&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">BOSCOCluster</span> <span class="o">=</span>!<span class="o">=</span> <span class="s2">&quot;ce03.cmsaf.mit.edu&quot;</span> <span class="o">)</span>

<span class="c1">#You can also control what sites you want to run at. Here is a sample list to use:</span>
+DESIRED_Sites <span class="o">=</span> <span class="s2">&quot;T2_AT_Vienna,T2_BE_IIHE,T2_BE_UCL,T2_BR_SPRACE,T2_BR_UERJ,T2_CH_CERN,T2_CH_CERN_AI,T2_CH_CERN_HLT,T2_CH_CERN_Wigner,T2_CH_CSCS,T2_CH_CSCS_HPC,T2_CN_Beijing,T2_DE_DESY,T2_DE_RWTH,T2_EE_Estonia,T2_ES_CIEMAT,T2_ES_IFCA,T2_FI_HIP,T2_FR_CCIN2P3,T2_FR_GRIF_IRFU,T2_FR_GRIF_LLR,T2_FR_IPHC,T2_GR_Ioannina,T2_HU_Budapest,T2_IN_TIFR,T2_IT_Bari,T2_IT_Legnaro,T2_IT_Pisa,T2_IT_Rome,T2_KR_KISTI,T2_MY_SIFIR,T2_MY_UPM_BIRUNI,T2_PK_NCP,T2_PL_Swierk,T2_PL_Warsaw,T2_PT_NCG_Lisbon,T2_RU_IHEP,T2_RU_INR,T2_RU_ITEP,T2_RU_JINR,T2_RU_PNPI,T2_RU_SINP,T2_TH_CUNSTDA,T2_TR_METU,T2_TW_NCHC,T2_UA_KIPT,T2_UK_London_IC,T2_UK_SGrid_Bristol,T2_UK_SGrid_RALPP,T2_US_Caltech,T2_US_Florida,T2_US_MIT,T2_US_Nebraska,T2_US_Purdue,T2_US_UCSD,T2_US_Vanderbilt,T2_US_Wisconsin,T3_CH_CERN_CAF,T3_CH_CERN_DOMA,T3_CH_CERN_HelixNebula,T3_CH_CERN_HelixNebula_REHA,T3_CH_CMSAtHome,T3_CH_Volunteer,T3_US_HEPCloud,T3_US_NERSC,T3_US_OSG,T3_US_PSC,T3_US_SDSC&quot;</span>
</pre></div>
</div>
<p>And finally you can also use OSG:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#Condor needs updating first</span>
</pre></div>
</div>
</div>
<div class="section" id="condor-example-1">
<h2>Condor example 1:<a class="headerlink" href="#condor-example-1" title="Permalink to this headline">¶</a></h2>
<p>Lets look at a full example condor submission for downloading some ROOT file and transfering the output. In this first example we will grab the ROOT file with xrootd and then transfer the file to hadoop scratch space using xrdcp. Lets run the following script in the condor job/ Lets call it script.sh. Make sure to update your username before running the script.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#if you need cvmfs or a given architecture</span>
<span class="nb">source</span> /cvmfs/cms.cern.ch/cmsset_default.sh
<span class="nb">export</span> <span class="nv">SCRAM_ARCH</span><span class="o">=</span>slc7_amd64_gcc820
<span class="nb">export</span> <span class="nv">HOME</span><span class="o">=</span>.

<span class="nb">echo</span> <span class="s2">&quot;hostname&quot;</span>
hostname

<span class="c1">#download the file</span>
xrdcp root://xrootd.cmsaf.mit.edu//store/user/paus/nanosu/A00/QCD_HT1000to1500_TuneCP5_13TeV-madgraphMLM-pythia8+RunIIAutumn18MiniAOD-102X_upgrade2018_realistic_v15-v1+MINIAODSIM/00A7C4D5-8881-5D47-8E1F-FADDC4B6FA96.root out.root

<span class="c1">#transfer the file</span>
xrdcp out.root root://t3serv017.mit.edu//scratch/&lt;username&gt;/

<span class="nb">echo</span> <span class="s2">&quot;----- transferring output to scratch :&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot; ------ THE END (everyone dies !) ----- &quot;</span>
</pre></div>
</div>
<p>and the corresponding condor.sub file. Make sure to update the uid in the x509 proxy. This will run on the T3 but can be modified to run in other locations.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">universe</span>              <span class="o">=</span> vanilla
<span class="nv">request_disk</span>          <span class="o">=</span> <span class="m">1024</span>
<span class="nv">executable</span>            <span class="o">=</span> script.sh
<span class="nv">arguments</span>             <span class="o">=</span> <span class="k">$(</span>ProcId<span class="k">)</span>
<span class="nv">should_transfer_files</span> <span class="o">=</span> YES
<span class="nv">output</span>                <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.out
<span class="nv">error</span>                 <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.err
<span class="nv">log</span>                   <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.log
<span class="nv">use_x509userproxy</span>     <span class="o">=</span> True
<span class="nv">x509userproxy</span>         <span class="o">=</span> /tmp/x509up_u&lt;uid&gt;
<span class="nv">when_to_transfer_output</span> <span class="o">=</span> ON_EXIT
<span class="nv">requirements</span>          <span class="o">=</span> <span class="o">(</span><span class="nv">BOSCOCluster</span> <span class="o">==</span> <span class="s2">&quot;t3serv008.mit.edu&quot;</span><span class="o">)</span>
queue <span class="m">10</span>
</pre></div>
</div>
<p>now you can submit your job:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>condor_submit condor.sub
</pre></div>
</div>
<p>This simple set up can be expanded to suit your needs. Just add your analyzer into the script.sh above and transfer the output in a similar way.</p>
</div>
<div class="section" id="condor-example-2">
<h2>Condor example 2:<a class="headerlink" href="#condor-example-2" title="Permalink to this headline">¶</a></h2>
<p>If you have smaller output and you want to use the workspace rather than hadoop we can do something similar but instead trasnfer the output from the submit machines through remaps. Similar the above we will use a script.sh</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#if you need cvmfs or a given architecture</span>
<span class="nb">source</span> /cvmfs/cms.cern.ch/cmsset_default.sh
<span class="nb">export</span> <span class="nv">SCRAM_ARCH</span><span class="o">=</span>slc7_amd64_gcc820
<span class="nb">export</span> <span class="nv">HOME</span><span class="o">=</span>.

<span class="nb">echo</span> <span class="s2">&quot;hostname&quot;</span>
hostname

<span class="c1">#download the file</span>
xrdcp root://xrootd.cmsaf.mit.edu//store/user/paus/nanosu/A00/QCD_HT1000to1500_TuneCP5_13TeV-madgraphMLM-pythia8+RunIIAutumn18MiniAOD-102X_upgrade2018_realistic_v15-v1+MINIAODSIM/00A7C4D5-8881-5D47-8E1F-FADDC4B6FA96.root out.root

<span class="nb">echo</span> <span class="s2">&quot;----- transferring output to scratch :&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot; ------ THE END (everyone dies !) ----- &quot;</span>
</pre></div>
</div>
<p>Similar to above, we will also need a condor.sub. However, this time we will transfer the file here rather than in the script. We will do this through a remap. Do not use this method to transer any files through the fuse mount!</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">universe</span>              <span class="o">=</span> vanilla
<span class="nv">request_disk</span>          <span class="o">=</span> <span class="m">1024</span>
<span class="nv">executable</span>            <span class="o">=</span> script.sh
<span class="nv">arguments</span>             <span class="o">=</span> <span class="k">$(</span>ProcId<span class="k">)</span>
<span class="nv">should_transfer_files</span> <span class="o">=</span> YES
<span class="nv">output</span>                <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.out
<span class="nv">error</span>                 <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.err
<span class="nv">log</span>                   <span class="o">=</span> <span class="k">$(</span>ClusterId<span class="k">)</span>.<span class="k">$(</span>ProcId<span class="k">)</span>.log
<span class="nv">use_x509userproxy</span>     <span class="o">=</span> True
<span class="nv">x509userproxy</span>         <span class="o">=</span> /tmp/x509up_u&lt;uid&gt;
<span class="nv">when_to_transfer_output</span> <span class="o">=</span> ON_EXIT
<span class="nv">transfer_output_remaps</span> <span class="o">=</span> <span class="s2">&quot;out.root = /work/submit/&lt;username&gt;/out.root&quot;</span>
<span class="nv">requirements</span>          <span class="o">=</span> <span class="o">(</span><span class="nv">BOSCOCluster</span> <span class="o">==</span> <span class="s2">&quot;t3serv008.mit.edu&quot;</span><span class="o">)</span>
queue <span class="m">10</span>
</pre></div>
</div>
</div>
<div class="section" id="slurm-examples">
<h2>Slurm examples:<a class="headerlink" href="#slurm-examples" title="Permalink to this headline">¶</a></h2>
<p>Slurm can also be used on the submit machines. There is a slurm federation on the submit machines as well as slurm clusters connected through lqcd. Below is a sample about how to submit a slurm job to the submit machines:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>there will be some code here soon!
</pre></div>
</div>
<p>And now an example for how to submit to the lqcd cluster from the submit machines. Here we need some extra set up and then test some simple srun commands like below:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#SBATCH --job-name=test</span>
<span class="c1">#SBATCH --output=res_%j.txt</span>
<span class="c1">#SBATCH --error=err_%j.txt</span>
<span class="c1">#</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --time=10:00</span>
<span class="c1">#SBATCH --mem-per-cpu=100</span>
<span class="c1">#SBATCH --cluster=lqcd</span>
<span class="c1">#SBATCH --partition=devel</span>

<span class="nb">unset</span> MODULEPATH
<span class="nb">unset</span> MODULESHOME
<span class="nb">export</span> <span class="nv">SLURM_CONF</span><span class="o">=</span>/opt/lqcd/etc/slurm.conf
. /opt/software/modules-4.4.0/init/bash
module add slurm

srun hostname
srun ls -hrlt
srun sleep <span class="m">60</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span></span><span class="pull-right">&copy; Copyright 2021, Chad Freer, Christoph Paus.
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.0.9/821a5457 [2020-04-16T19:31:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $filter = $('#toc-filter-query');
  var $toclist = $('.sidebar-toc > ul').find('li');

  if ($toclist.length === 0) {
    $toclist = $('.localtoc > ul').find('li');
  }


  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = 'search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }


  function apply_filter() {
    var s = $filter.val().trim().toLowerCase();

    $toclist.find('a').removeClass('hidden');
    $toclist.each(function() {
      var $this = $(this);
      var $link = $this.find('> a');
      var t = $link.text().toLowerCase();
      var show = t.indexOf(s) >= 0;

      if (!show) {
        $link.addClass('hidden');
      }
    });
  }

  $filter.on('keyup', function(e) {
    apply_filter();
  });



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>